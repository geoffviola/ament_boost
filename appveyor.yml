image: Visual Studio 2015

environment:
  matrix:
    - GENERATOR: "Visual Studio 14 2015 Win64"
      CONFIG: Release
      PYTHON: "C:\\Python35-x64"
      PYTHON_VERSION: "3.5.0"
      PYTHON_ARCH: "64"
  github_o_auth:
    secure: aUDHgyx/y2Z+bVu0zVHJq8T9fQVCulPJ4N23BSUjhaMpRCqwrE6P0ACBN/l0+jCP

platform:
  - x64

matrix:
  fast_finish: true

install:
  - md C:\dev
  - ps: Invoke-WebRequest https://github.com/osrf/opensplice/releases/download/6.4.0-0/opensplice-Win64VS2013-with-VS2015-patch.zip -OutFile C:\dev\opensplice.zip
  - 7z x -bso0 C:\dev\opensplice.zip -oC:\dev
  - ps: Invoke-WebRequest https://github.com/ros2/ros2/releases/download/release-alpha8/ros2-alpha8-package-windows-opensplice.zip -OutFile C:\dev\ros2.zip
  - 7z x -bso0 C:\dev\ros2.zip -oC:\dev
  - ren C:\dev\ros2-windows ros2
  - set PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%
  - set PATH=C:\Program Files (x86)\MSBuild\14.0\Bin;%PATH%
  - call "C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\Tools\vsvars32.bat"
  - ps: $local_setup_bat_content = Get-Content C:\dev\ros2\local_setup.bat -Raw
  - ps: $local_setup_bat_content = $local_setup_bat_content -replace "C:\\ProgramData\\chocolatey\\lib\\python3\\tools\\python.exe", "python"
  - ps: $local_setup_bat_content | Out-File -Encoding DEFAULT -FilePath C:\dev\ros2\local_setup.bat
  - call C:\dev\ros2\setup.bat

before_build:
  - cd ..
  - md ament_boost_ws
  - md ament_boost_ws\src
  - ren ament-boost ament_boost 
  - mv ament_boost ament_boost_ws\src
  - cd ament_boost_ws

build_script:
  - md build
  - cd build
  - cmake ../src/ament_boost -G"%GENERATOR%"
  - cmake --build . --config %CONFIG%
  - msbuild INSTALL.vcxproj
  - cd ..
  - pwd

before_deploy:
  - dir
  - xcopy /e /c /i /y install ament_boost_x64_windows
  - 7z a -tzip ament_boost_x64_windows.zip ament_boost_x64_windows

deploy:
  release: ament_boost_x64_windows
  description: 'ament_boost'
  provider: GitHub
  auth_token:
    secure: $(github_o_auth)
  artifact: ament_boost_x64_windows.zip
  draft: false
  prerelease: false
  on:
    branch: master
    appveyor_repo_tag: true
